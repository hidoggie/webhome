<!doctype html>
<html lang="ko">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sky Effect</title>
    <link rel="stylesheet" type="text/css" href="./index.css">
    <script type="importmap">
    { 
       "imports": { 
          "three": "https://cdn.jsdelivr.net/npm/three@0.123.0/build/three.module.js" 
        } 
     } 
     </script> 
     <script type="module"> 
        import * as THREE from "three"; 
        import { skySampleScenePipelineModule } from './sky-scene-pipeline-module.js';

const onxrloaded = () => {
  XR8.addCameraPipelineModules([  // Add camera pipeline modules.
    // Existing pipeline modules.
    XR8.GlTextureRenderer.pipelineModule(),      // Draws the camera feed.
    XR8.Threejs.pipelineModule(),                // Creates a ThreeJS AR Scene as well as a Sky scene.
    window.LandingPage.pipelineModule(),         // Detects unsupported browsers and gives hints.
    XRExtras.FullWindowCanvas.pipelineModule(),  // Modifies the canvas to fill the window.
    XRExtras.Loading.pipelineModule(),           // Manages the loading screen on startup.
    XRExtras.RuntimeError.pipelineModule(),      // Shows an error image on runtime error.

    // Enables Sky Segmentation.
    XR8.LayersController.pipelineModule(),
    SkyCoachingOverlay.pipelineModule(),

    // Custom pipeline module to add virtual content to the sky scene.
    skySampleScenePipelineModule(),
  ])

  XR8.LayersController.configure({layers: {sky: {invertLayerMask: false}}})
  XR8.Threejs.configure({layerScenes: ['sky']})

  // Add a canvas to the document for our xr scene.
  document.body.insertAdjacentHTML('beforeend', `
    <canvas id="camera" width="${window.innerWidth}" height="${window.innerHeight}"></canvas>
  `)

  // Open the camera and start running the camera run loop.
  XR8.run({
    canvas: document.getElementById('camera'),
    verbose: true,
  })
}

window.XR8 ? onxrloaded() : window.addEventListener('xrloaded', onxrloaded)
      
    </script>    
    <script src="./../xr_st/xrextras.js"></script>
    <script src="./../xr_st/landing-page.js"></script>  
    <script src="./../xr_st/coaching-overlay.js"></script>  

    <!-- 8thWall Web - Replace the app key here with your own app key -->
    <script async src="./../xr_st/xr.js" data-preload-chunks="slam"></script>

    <!-- Main app script - loads as module to use ES6 imports -->
    <!--script type="module" src="./app.js"></script>
    <script type="module" src="./sky-scene-pipeline-module.js"></script-->

    <link rel="stylesheet" href="./index.css">

  </head>

  <body>
    <canvas id="camerafeed"></canvas>
  </body>
</html>
